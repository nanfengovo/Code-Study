# 读取本地的json文件配置
## 直接读取
1、新建控制台项目，创建json文件设置属性“如果较新则复制”
2、NuGet安装Microsoft.Extensions.Configuration 和 Microsoft.Extensions.Configuration.json

config.json
```
{
  "name": "yzk",
  "age": "18"
}

```

 Install-package Microsoft.Extensions.Configuration
 Install-package Microsoft.Extensions.Configuration.json
program.cs
```
using Microsoft.Extensions.Configuration;

namespace Config1
{
    internal class Program
    {
        static void Main(string[] args)
        {
            ConfigurationBuilder builder = new ConfigurationBuilder();
            builder.AddJsonFile("config.json",optional:true,reloadOnChange:true);
            IConfigurationRoot configuration = builder.Build();
            string name = configuration["name"]!;
            var age = configuration["age"]!;
            var address = configuration["address"]!;
            Console.WriteLine(name);
            Console.WriteLine(age);
            Console.WriteLine(address);
        }
    }
}
```
## 绑定对象读取
config.json
```
{
  "Config": {
    "name": "yzk",
    "age": "18"
  }
}

```

新建类
```
    class Config
    {
        public string Name { get; set; } = string.Empty;

        public string Age { get; set; } = string.Empty;
    }
```
安装Microsoft.Extensions.Configuration.Binder
> Install-package Microsoft.Extensions.Configuration.Binder

```
        static void Main(string[] args)
        {
            ConfigurationBuilder builder = new ConfigurationBuilder();
            builder.AddJsonFile("config.json",optional:true,reloadOnChange:true);
            IConfigurationRoot configuration = builder.Build();
            //string name = configuration["name"]!;
            //var age = configuration["age"]!;
            //var address = configuration["address"]!;
            //Console.WriteLine(name);
            //Console.WriteLine(age);
            //Console.WriteLine(address);

            var s = configuration.GetSection("Config").Get<Config>();
            Console.WriteLine(s.Name);
            
        }
```

# 选项配置的读取
> 1、推荐使用选项方式读取，和DI结合的更好，且更好利用“Reloadonchange”机制
> 2、NuGet安装：Microsoft.Extensions.Options、Microsoft.Extensions.Configuration.Binder,Microsoft.Extension.Configuration、Microsoft.Extensions.Configuration.Json
> 3、读取配置的时候，DI要声明IOptions、IOptionsMonitor、IOptionsSnapshot等类型，IOptions不会读取到新的值；与IOptionsMonitor相比，IOptionsSnapshot会在一个范围内（比如一个请求中）保持一致，建议使用IOptionsSnapshot

## 如何使用IOptionsSnapshot选项配置读取

program.cs
```
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.DependencyInjection;

namespace ConfigDI
{
    internal class Program
    {
        static void Main(string[] args)
        {
            ConfigurationBuilder builder = new ConfigurationBuilder();
            builder.AddJsonFile("config.json", optional: true, reloadOnChange: true);
            IConfigurationRoot configuration = builder.Build();
            ServiceCollection services = new ServiceCollection();
            services.AddScoped<TestController>();
            services.AddOptions().Configure<Config>(e => configuration.Bind(e));
            using (var sp = services.BuildServiceProvider())
            {
                var c = sp.GetRequiredService<TestController>();
                c.Test();
            }

        }
    }

    public class Config
    {
        public string Name { get; set; } = string.Empty;

        public string Age { get; set; } = string.Empty;
    }
}
```

config.json
```
{
  "name": "yzk",
  "age": "18"
}
```

```
using Microsoft.Extensions.Options;
using System;
using System.Collections.Generic;
using System.Text;

namespace ConfigDI
{
    public class TestController
    {
        private readonly IOptionsSnapshot<Config> _optConfig;

        public TestController(IOptionsSnapshot<Config> optConfig)
        {
            _optConfig = optConfig;
        }

        public void Test()
        {
            Console.WriteLine(_optConfig.Value.Age);
            Console.WriteLine("************************");
            Console.WriteLine(_optConfig.Value.Age);
        }
    }
}
```

